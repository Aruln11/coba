<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>nge cv yuk</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        :root {
            --bg-color: #0d021a;
            --main-color: #00f0ff;
            --accent-color: #ff00ff;
            --success-color: #39ff14;
            --error-color: #ff4d4d;
            --info-color: #ffff00;
            --container-bg: rgba(20, 30, 45, 0.85);
            --border-color: rgba(0, 240, 255, 0.2);
        }
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body { background-color: var(--bg-color); background-image: linear-gradient(var(--border-color) 1px, transparent 1px), linear-gradient(90deg, var(--border-color) 1px, transparent 1px); background-size: 30px 30px; color: var(--main-color); font-family: 'Share Tech Mono', monospace; font-size: 16px; animation: fadeInBg 2s ease; padding: 20px; box-sizing: border-box; }
        
        .main-container {
            background-color: var(--container-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            height: 100%;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 0 25px rgba(0, 240, 255, 0.3);
            animation: fadeIn 1s ease-in-out;
            box-sizing: border-box;
            cursor: text;
        }

        #output p, .rekap-results p { margin: 5px 0; white-space: pre-wrap; word-wrap: break-word; text-shadow: 0 0 5px var(--main-color); }
        .prompt-line { display: flex; align-items: center; margin-top: 1em; }
        
        /* --- PERUBAHAN CSS UTAMA --- */
        #terminal-input {
            flex-grow: 1; /* Biarkan input mengisi sisa ruang */
            background-color: transparent;
            border: none;
            outline: none; /* Hapus outline saat fokus */
            color: var(--main-color);
            font-family: inherit;
            font-size: inherit;
            padding: 0;
            margin: 0;
            text-shadow: 0 0 5px var(--main-color); /* Cocokkan dengan gaya teks lain */
        }
        /* Mengubah warna kursor bawaan browser */
        #terminal-input {
            caret-color: var(--main-color);
        }
        /* Hapus kursor palsu karena kita pakai kursor asli dari input */
        .cursor { display: none; }

        .rekap-input, .rekap-data {
            background-color: transparent;
            border: 1px solid var(--main-color);
            color: var(--main-color);
            font-family: inherit;
            font-size: inherit;
            padding: 8px;
            border-radius: 4px;
            width: 100%;
            box-sizing: border-box;
        }

        .terminal-button {
            background-color: transparent; border: 1px solid var(--main-color); color: var(--main-color);
            font-family: inherit; padding: 8px 15px; cursor: pointer;
            transition: all 0.2s ease-in-out; display: inline-block; margin-top: 5px;
            box-sizing: border-box;
        }
        .rekap-button {
            border-color: var(--success-color); color: var(--success-color);
        }
        .rekap-button:hover { background-color: rgba(57, 255, 20, 0.2); }

        .rekap-container h1 { text-align: center; margin-top: 0; }
        .rekap-data { min-height: 150px; }
        .rekap-group { margin: 20px 0; }
        
        .inline-select {
            background: rgba(0,0,0,0.3); border: 1px solid var(--main-color); color: var(--main-color);
            font-family: inherit; padding: 8px; border-radius: 4px;
            box-sizing: border-box;
        }
        
        .inline-select option {
            background-color: var(--bg-color);
            color: var(--main-color);
        }

        pre.recap-block { font-family: inherit; color: var(--info-color); margin: 5px 0; white-space: pre; }

        a { color: var(--accent-color); text-decoration: none; }
        .success { color: var(--success-color); } .error { color: var(--error-color); } .info { color: var(--info-color); }

        #upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            margin-top: 15px;
            transition: background-color 0.3s, border-color 0.3s;
        }
        #upload-area.dragover {
            background-color: rgba(0, 240, 255, 0.1);
            border-color: var(--main-color);
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 10px; 
            margin-top: 10px;
        }
        .input-group > .terminal-button {
            margin-top: 0;
        }

        #loader {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background-color: rgba(13, 2, 26, 0.9);
            z-index: 9999; justify-content: center; align-items: center;
            flex-direction: column; text-align: center;
        }
        .spinner {
            border: 4px solid var(--border-color); border-top: 4px solid var(--main-color);
            border-radius: 50%; width: 40px; height: 40px;
            animation: spin 1s linear infinite; margin-bottom: 15px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes fadeInBg { from { background-color: transparent; } to { background-color: var(--bg-color); } }

        @media (max-width: 600px) {
            .input-group { flex-direction: column; align-items: stretch; }
        }
    </style>
</head>
<body>
    <div id="terminal-container" class="main-container">
        <div id="output"></div>
        <form id="terminal-form" class="prompt-line">
            <span class="prompt-text">>_&nbsp;</span> <input type="text" id="terminal-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
            </form>
    </div>

    <div id="rekap1-container" class="main-container rekap-container" style="display:none;">
        <h1>Rekap Khusus Admin</h1>
        <div class="rekap-group">
            <p>Paste data rekap di sini (Format: Nama Grup = Jumlah Kontak):</p>
            <textarea id="rekap1-data" class="rekap-data" placeholder="dark sistem 001 = 50 kontak&#10;dark sistem 002 = 40 kontak"></textarea>
        </div>
        <div class="rekap-group">
            <p>Harga per Kontak (Rp):</p>
            <input type="number" id="rekap1-harga" class="rekap-input" placeholder="Contoh: 1000">
        </div>
        <button id="rekap1-hitung" class="terminal-button rekap-button">Hitung</button>
        <div id="rekap1-results" class="rekap-results"></div>
        <hr style="border-color: var(--border-color); margin: 20px 0;">
        <button id="rekap1-kembali" class="terminal-button">Kembali ke Terminal</button>
    </div>

    <div id="rekap2-container" class="main-container rekap-container" style="display:none;">
        <h1>Rekap Khusus D9</h1>
        <div class="rekap-group">
            <p>Paste data rekap di sini (Format: Data = Jumlah, diakhiri nama pemilik):</p>
            <textarea id="rekap2-data" class="rekap-data" placeholder="Fanny 45 = 83&#10;Fanny 46 = 91&#10;@arul&#10;&#10;Fanny 47 = 53&#10;fanny"></textarea>
        </div>
        <div class="rekap-group">
            <p>Harga per Kontak (Rp):</p>
            <input type="number" id="rekap2-harga" class="rekap-input" placeholder="Contoh: 1200">
        </div>
        <button id="rekap2-hitung" class="terminal-button rekap-button">Hitung</button>
        <div id="rekap2-results" class="rekap-results"></div>
        <hr style="border-color: var(--border-color); margin: 20px 0;">
        <button id="rekap2-kembali" class="terminal-button">Kembali ke Terminal</button>
    </div>

    <div id="loader">
        <div class="spinner"></div>
        <p id="loader-text">Sedang memproses...</p>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- PERUBAHAN JAVASCRIPT UTAMA ---
            const terminalContainer = document.getElementById('terminal-container');
            const rekap1Container = document.getElementById('rekap1-container');
            const rekap2Container = document.getElementById('rekap2-container');
            const output = document.getElementById('output');
            const loader = document.getElementById('loader');
            const loaderText = document.getElementById('loader-text');
            const terminalForm = document.getElementById('terminal-form');
            // Mengganti input tersembunyi dengan input yang baru
            const terminalInput = document.getElementById('terminal-input');
            let isTerminalActive = true; 

            // Hapus variabel yang tidak perlu
            // const commandDisplay = document.getElementById('command-display');

            let stage = 'welcome';
            let params = {};
            const countryCodes = { '62': 'Indonesia', '852': 'Hong Kong', '1': 'Amerika', '54': 'Argentina', '49': 'Jerman', '60': 'Malaysia' };
            const countryCodeKeys = Object.keys(countryCodes).sort((a, b) => a.length - b.length);

            function print(message, className = '') { const p = document.createElement('p'); p.className = className; p.innerHTML = message.replace(/\n/g, '<br>'); output.appendChild(p); if (terminalContainer.style.display !== 'none') terminalContainer.scrollTop = terminalContainer.scrollHeight; }
            function showInput() { document.querySelector('.prompt-line').style.display = 'flex'; }
            function hideInput() { document.querySelector('.prompt-line').style.display = 'none'; }
            function clearScreen() { output.innerHTML = ''; }
            function showLoader(message) { loaderText.textContent = message; loader.style.display = 'flex'; }
            function hideLoader() { loader.style.display = 'none'; }

            function showHelp() {
                print("\nBantuan Perintah:", "info");
                print("  start    - Memulai proses VCF.");
                print("  rekap 1  - Membuka Rekap Khusus Admin.");
                print("  rekap 2  - Rekap Khusus D9.");
                print("  batal    - Membatalkan proses saat ini.");
                print("  cls      - Membersihkan layar terminal.");
                print("  help     - Menampilkan bantuan ini.");
            }
            
            function createVCFs(contacts, perFile, fileBase, nameBase, defaultCountryCode) {
                const allContacts = contacts.split('\n').filter(line => line.trim() !== '');
                if (allContacts.length === 0) { print("Tidak ada kontak valid untuk diproses.", "error"); return null; }
                const totalContacts = allContacts.length;
                const padding = totalContacts.toString().length;
                const vcfData = [];
                for (let i = 0; i < allContacts.length; i += perFile) {
                    const chunk = allContacts.slice(i, i + perFile);
                    let vcfContent = '';
                    chunk.forEach((number, index) => {
                        let finalNumber = number.trim().replace(/\s|\(|\)|-/g, '');
                        if (finalNumber === '') return; 
                        let detected = false;
                        if (finalNumber.startsWith('+')) {
                           detected = true;
                        } else {
                            for (const code of countryCodeKeys) {
                                if (finalNumber.startsWith(code)) {
                                    finalNumber = '+' + finalNumber;
                                    detected = true;
                                    break;
                                }
                            }
                        }
                        if (!detected && defaultCountryCode) {
                            if (finalNumber.startsWith('0')) {
                                finalNumber = `+${defaultCountryCode}${finalNumber.substring(1)}`;
                            } else {
                                finalNumber = `+${defaultCountryCode}${finalNumber}`;
                            }
                        } else if (!detected && !finalNumber.startsWith('+')) {
                            finalNumber = '+' + finalNumber;
                        }
                        const contactIndex = i + index + 1;
                        const paddedIndex = String(contactIndex).padStart(padding, '0');
                        const contactName = `${nameBase} ${paddedIndex}`;
                        vcfContent += `BEGIN:VCARD\nVERSION:3.0\nFN:${contactName}\nTEL;TYPE=CELL:${finalNumber}\nEND:VCARD\n\n`;
                    });
                    const fileNumber = Math.ceil((i + 1) / perFile);
                    const fileName = `${fileBase}${fileNumber}.vcf`;
                    vcfData.push({ name: fileName, content: vcfContent });
                }
                return vcfData;
            }

            function displayDownloadLink(blob, fileName) {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = fileName;
                link.innerHTML = `[ Download ${fileName} ]`;
                const p = document.createElement('p'); p.appendChild(link); output.appendChild(p);
            }

            function generateAndDownloadZIP(vcfData, fileBase, totalContacts, perFile) {
                showLoader('Menggabungkan file ke dalam ZIP...');
                const zip = new JSZip();
                vcfData.forEach(file => { zip.file(file.name, file.content); });
                zip.generateAsync({ type: "blob" }).then(function(content) {
                    hideLoader();
                    print("\nBerhasil!", 'success');
                    const zipFileName = `${fileBase}.zip`;
                    displayDownloadLink(content, zipFileName);
                    print(`Klik link di atas untuk mengunduh.`, 'info');
                    const namesList = [];
                    const totalFiles = Math.ceil(totalContacts / perFile);
                    for (let i = 1; i <= totalFiles; i++) { namesList.push(`${fileBase}${i}`); }
                    const listText = namesList.join('\n');
                    const listContainer = document.createElement('div');
                    listContainer.style.cssText = 'max-height: 150px; overflow-y: auto; background-color: rgba(0,0,0,0.2); border: 1px solid var(--border-color); padding: 10px; margin-top: 10px;';
                    const listContent = document.createElement('p');
                    listContent.style.cssText = 'white-space: pre-wrap; word-break: break-all;';
                    listContent.textContent = listText;
                    listContainer.appendChild(listContent);
                    output.appendChild(listContainer);
                    const copyButton = document.createElement('button');
                    copyButton.textContent = "Salin Daftar Nama";
                    copyButton.className = 'terminal-button';
                    copyButton.onclick = function() {
                        navigator.clipboard.writeText(listText).then(() => {
                            copyButton.textContent = "Berhasil Disalin!";
                            setTimeout(() => { copyButton.textContent = "Salin Daftar Nama"; }, 2000);
                        }).catch(err => { print('Gagal menyalin: ' + err, 'error'); });
                    };
                    output.appendChild(copyButton);
                }).catch(err => {
                    hideLoader();
                    print(`Error saat membuat ZIP: ${err}`, 'error');
                });
            }
            
            function processFile(file) {
                 if (!file || !file.type.match('text.*')) { print("Error: Harap pilih file .txt", "error"); showInput(); return; }
                const reader = new FileReader();
                reader.onload = (event) => {
                    const contactsContent = event.target.result;
                    const lineCount = contactsContent.split('\n').filter(line => line.trim() !== '').length;
                    params.contacts = contactsContent;
                    print(`[+] Berhasil memuat ${lineCount} kontak valid dari ${file.name}.`, 'success');
                    stage = 'get_per_file';
                    showPrompt();
                };
                reader.onerror = () => print("Gagal membaca file.", "error");
                reader.readAsText(file);
                showInput();
            }

            function showPrompt() {
                switch (stage) {
                    case 'welcome':
                        print("fydialgo makasih bang udah dicobain\n------------------------");
                        print("Ketik 'start' untuk proses VCF, atau 'rekap' untuk kalkulator.");
                        print("Ketik 'help' untuk daftar perintah.", "info");
                        break;
                    case 'get_default_country':
                        isTerminalActive = false; hideInput();
                        print("\nTentukan Negara Asal untuk Data Kontak.");
                        const uiContainer = document.createElement('div');
                        uiContainer.className = 'input-group';
                        const selectMenu = document.createElement('select');
                        selectMenu.className = 'inline-select';
                        const sortedCountries = Object.entries(countryCodes).sort(([, nameA], [, nameB]) => nameA.localeCompare(nameB));
                        for (const [code, name] of sortedCountries) {
                            const option = document.createElement('option');
                            option.value = code; option.textContent = name;
                            if (code === '62') { option.selected = true; }
                            selectMenu.appendChild(option);
                        }
                        uiContainer.appendChild(selectMenu);
                        const confirmButton = document.createElement('button');
                        confirmButton.textContent = "Lanjutkan";
                        confirmButton.className = 'terminal-button';
                        confirmButton.onclick = () => {
                            params.default_country = selectMenu.value;
                            const countryName = countryCodes[selectMenu.value];
                            print(`[+] Negara asal telah diatur ke: ${countryName}.`, 'success');
                            uiContainer.remove(); stage = 'get_input_method';
                            showInput(); showPrompt(); isTerminalActive = true;
                        };
                        uiContainer.appendChild(confirmButton);
                        output.appendChild(uiContainer);
                        break;
                    case 'get_input_method': print("\nPilih Metode Input: 'upload' atau 'paste'?"); break;
                    case 'handle_paste':
                        isTerminalActive = false; hideInput();
                        print("\nSilakan salin dan tempel daftar kontak Anda di bawah ini.");
                        const textarea = document.createElement('textarea');
                        textarea.style="width: 100%; height: 150px; background: rgba(0,0,0,0.3); color: var(--main-color); border: 1px solid var(--main-color); margin-top:10px; font-family:inherit; resize:vertical; box-sizing: border-box;";
                        output.appendChild(textarea);
                        const doneButton = document.createElement('button');
                        doneButton.textContent = "Lanjutkan";
                        doneButton.className = 'terminal-button';
                        output.appendChild(doneButton);
                        textarea.focus();
                        doneButton.onclick = () => {
                            const contactsContent = textarea.value;
                            const lineCount = contactsContent.split('\n').filter(line => line.trim() !== '').length;
                            params.contacts = contactsContent;
                            if (lineCount > 0) {
                                print(`[+] Diterima ${lineCount} kontak valid.`, "success");
                                stage = 'get_per_file'; showPrompt();
                            } else {
                                print("Tidak ada input. Proses dibatalkan.", "error"); stage = 'welcome'; showPrompt();
                            }
                            textarea.remove(); doneButton.remove(); showInput(); isTerminalActive = true;
                        };
                        break;
                    case 'handle_upload':
                        hideInput();
                        print("\nSilakan pilih file .txt atau seret file ke area di bawah.");
                        const uploadArea = document.createElement('div');
                        uploadArea.id = 'upload-area';
                        uploadArea.innerHTML = `<p>Seret & Lepas File .txt di Sini</p><p>atau</p>`;
                        const fileInput = document.createElement('input'); fileInput.type = 'file'; fileInput.accept = '.txt'; fileInput.style.display = 'none';
                        const uploadLabel = document.createElement('label');
                        uploadLabel.textContent = "[ Pilih File ]";
                        uploadLabel.className = 'terminal-button';
                        uploadArea.appendChild(uploadLabel);
                        output.appendChild(fileInput); 
                        output.appendChild(uploadArea);
                        uploadLabel.onclick = () => fileInput.click();
                        fileInput.onchange = (e) => { uploadArea.remove(); processFile(e.target.files[0]); };
                        uploadArea.addEventListener('dragover', (e) => { e.preventDefault(); e.stopPropagation(); uploadArea.classList.add('dragover'); });
                        uploadArea.addEventListener('dragleave', (e) => { e.preventDefault(); e.stopPropagation(); uploadArea.classList.remove('dragover'); });
                        uploadArea.addEventListener('drop', (e) => { e.preventDefault(); e.stopPropagation(); uploadArea.classList.remove('dragover'); uploadArea.remove(); processFile(e.dataTransfer.files[0]); });
                        break;
                    case 'get_per_file': print("\nTentukan jumlah kontak per file (Contoh: 50)"); break;
                    case 'get_file_base': print("\nMasukan nama file output (Contoh: Fanny)"); break;
                    case 'get_name_base': print("\nBerikan nama isi kontak (Contoh: Dark Sistem)"); break;
                    case 'confirm':
                        const totalContacts = (params.contacts || '').split('\n').filter(line => line.trim() !== '').length;
                        const totalFiles = Math.ceil(totalContacts / params.per_file);
                        const countryName = countryCodes[params.default_country];
                        const padding = totalContacts.toString().length;
                        const examplePaddedIndex = '1'.padStart(padding, '0');
                        const recapData = { 
                            "Negara Asal": `<span class="info">${countryName} (+${params.default_country})</span>`,
                            "Total Kontak Valid": `<span class="success">${totalContacts} nomor</span>`, 
                            "Kontak per File": `<span class="success">${params.per_file} nomor</span>`, 
                            "Akan Dibuat": `<span class="success">${totalFiles} file VCF</span>`, 
                            "Penamaan File": `<span class="info">${params.file_base}1.vcf, ...</span>`, 
                            "Penamaan Kontak": `<span class="info">${params.name_base} ${examplePaddedIndex}, ...</span>` 
                        };
                        let recapLines = []; let maxLabelLength = 0;
                        for (const label in recapData) { if (label.length > maxLabelLength) maxLabelLength = label.length; }
                        for (const label in recapData) { recapLines.push(`${label.padEnd(maxLabelLength)} : ${recapData[label]}`); }
                        print("\n--// Rekapitulasi & Konfirmasi //--", "info");
                        print(`<pre class="recap-block">${recapLines.join('\n')}</pre>`);
                        print(`Ketik 'proses' untuk membuat file, atau 'batal' untuk mengulang.`);
                        break;
                }
            }

            // --- SISTEM INPUT BARU ---
            // Saat wadah terminal diklik, fokuskan ke input
            terminalContainer.addEventListener('click', () => {
                if (isTerminalActive) {
                    terminalInput.focus();
                }
            });
            
            // Hapus listener untuk commandDisplay karena sudah tidak ada

            terminalForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!isTerminalActive) return;

                // Ambil nilai langsung dari terminalInput
                const originalInput = terminalInput.value.trim();
                const command = originalInput.toLowerCase();

                if (originalInput) print(`>_ ${originalInput}`);
                
                // Kosongkan input setelah submit
                terminalInput.value = '';
                
                if (command === '') return;
                
                if (command === 'cls') { clearScreen(); showPrompt(); return; }
                if (command === 'help') { showHelp(); return; }
                if (command === 'batal') { stage = 'welcome'; params = {}; print("\nProses dibatalkan.", 'info'); clearScreen(); showPrompt(); return; }

                if (command.startsWith('rekap')) {
                    if (command === 'rekap 1') {
                        isTerminalActive = false;
                        terminalContainer.style.display = 'none';
                        rekap2Container.style.display = 'none';
                        rekap1Container.style.display = 'block';
                    } else if (command === 'rekap 2') {
                        isTerminalActive = false;
                        terminalContainer.style.display = 'none';
                        rekap1Container.style.display = 'none';
                        rekap2Container.style.display = 'block';
                    } else {
                        print(`Perintah '${originalInput}' tidak dikenal. Ketik 'help' untuk bantuan.`, 'error');
                    }
                    return;
                }

                switch (stage) {
                    case 'welcome': 
                        if (command === 'start') { stage = 'get_default_country'; showPrompt(); } 
                        else { print(`Perintah '${originalInput}' tidak dikenal.`, 'error'); }
                        break;
                    case 'get_input_method':
                        if (command === 'upload') { stage = 'handle_upload'; showPrompt(); }
                        else if (command === 'paste') { stage = 'handle_paste'; showPrompt(); }
                        else { print("Pilihan tidak valid. Gunakan 'upload' atau 'paste'.", "error"); }
                        break;
                    case 'get_per_file':
                        const num = parseInt(command);
                        if (isNaN(num) || num <= 0) { print("Error: Masukkan angka positif yang valid.", "error"); } 
                        else { params.per_file = num; stage = 'get_file_base'; showPrompt(); }
                        break;
                    case 'get_file_base':
                        if (!originalInput) { print("Error: Nama file tidak boleh kosong.", "error"); break; }
                        params.file_base = originalInput; stage = 'get_name_base'; showPrompt();
                        break;
                    case 'get_name_base':
                        if (!originalInput) { print("Error: Nama kontak tidak boleh kosong.", "error"); break; }
                        params.name_base = originalInput; stage = 'confirm'; showPrompt();
                        break;
                    case 'confirm':
                        if (command === 'proses') {
                            const totalContacts = (params.contacts || '').split('\n').filter(line => line.trim() !== '').length;
                            showLoader('Membuat VCF...');
                            setTimeout(() => {
                                const vcfData = createVCFs(params.contacts, params.per_file, params.file_base, params.name_base, params.default_country);
                                if (vcfData && vcfData.length > 0) {
                                    generateAndDownloadZIP(vcfData, params.file_base, totalContacts, params.per_file); 
                                } else {
                                    hideLoader();
                                    print("Tidak ada VCF yang dibuat. Periksa kembali kontak Anda.", "error");
                                }
                                stage = 'welcome';
                                setTimeout(() => showPrompt(), 500);
                            }, 50);
                        }
                        break;
                }
            });

            function setupRekap1Tool() {
                const rekapDataEl = document.getElementById('rekap1-data');
                const rekapHargaEl = document.getElementById('rekap1-harga');
                const hitungBtn = document.getElementById('rekap1-hitung');
                const kembaliBtn = document.getElementById('rekap1-kembali');
                const resultsEl = document.getElementById('rekap1-results');
                hitungBtn.addEventListener('click', () => {
                    const data = rekapDataEl.value.trim();
                    const harga = parseFloat(rekapHargaEl.value);
                    if (!data) { resultsEl.innerHTML = '<p class="error">Error: Data rekap tidak boleh kosong.</p>'; return; }
                    if (isNaN(harga) || harga <= 0) { resultsEl.innerHTML = '<p class="error">Error: Harga per kontak tidak valid.</p>'; return; }
                    const lines = data.split('\n');
                    let totalKontak = 0;
                    lines.forEach(line => {
                        const parts = line.split('=');
                        if (parts.length >= 2) {
                            const kontakCount = parseInt(parts[1].trim(), 10);
                            if (!isNaN(kontakCount)) { totalKontak += kontakCount; }
                        }
                    });
                    const totalPendapatan = totalKontak * harga;
                    const formatter = new Intl.NumberFormat('id-ID');
                    resultsEl.innerHTML = `<p class="success">Total Kontak Masuk: ${formatter.format(totalKontak)}</p><p class="success">Total Pendapatan: ${formatter.format(totalKontak)} x Rp ${formatter.format(harga)} = Rp ${formatter.format(totalPendapatan)}</p>`;
                });
                kembaliBtn.addEventListener('click', () => {
                    rekap1Container.style.display = 'none';
                    terminalContainer.style.display = 'block';
                    isTerminalActive = true;
                    terminalInput.focus();
                });
            }
            
            function setupRekap2Tool() {
                const rekapDataEl = document.getElementById('rekap2-data');
                const rekapHargaEl = document.getElementById('rekap2-harga');
                const hitungBtn = document.getElementById('rekap2-hitung');
                const kembaliBtn = document.getElementById('rekap2-kembali');
                const resultsEl = document.getElementById('rekap2-results');
                hitungBtn.addEventListener('click', () => {
                    const data = rekapDataEl.value.trim();
                    const harga = parseFloat(rekapHargaEl.value);
                    if (!data) { resultsEl.innerHTML = '<p class="error">Error: Data rekap tidak boleh kosong.</p>'; return; }
                    if (isNaN(harga) || harga <= 0) { resultsEl.innerHTML = '<p class="error">Error: Harga per kontak tidak valid.</p>'; return; }
                    resultsEl.innerHTML = '';
                    document.getElementById('rekap2-copy-btn')?.remove();
                    const lines = data.split('\n');
                    let subtotalKontak = 0;
                    let hasResults = false;
                    const formatter = new Intl.NumberFormat('id-ID');
                    const displaySubtotal = (ownerName) => {
                        if (subtotalKontak > 0) {
                            hasResults = true;
                            const subtotalPendapatan = subtotalKontak * harga;
                            const resultBlock = document.createElement('div');
                            resultBlock.style.marginTop = '15px';
                            resultBlock.innerHTML = `<p class="info">Hasil untuk: ${ownerName}</p><p class="success">Total Kontak Masuk: ${formatter.format(subtotalKontak)}</p><p class="success">Total Pendapatan: ${formatter.format(subtotalKontak)} x Rp ${formatter.format(harga)} = Rp ${formatter.format(subtotalPendapatan)}</p>`;
                            resultsEl.appendChild(resultBlock);
                            subtotalKontak = 0;
                        }
                    };
                    lines.forEach(line => {
                        const trimmedLine = line.trim();
                        if (trimmedLine.includes('=')) {
                            const parts = trimmedLine.split('=');
                            if (parts.length >= 2) {
                                const kontakCount = parseInt(parts[1].trim(), 10);
                                if (!isNaN(kontakCount)) { subtotalKontak += kontakCount; }
                            }
                        } else if (trimmedLine !== '') {
                            displaySubtotal(trimmedLine);
                        }
                    });
                    if (subtotalKontak > 0) {
                        displaySubtotal("Sisa (tanpa nama pemilik di akhir)");
                    }
                    if(hasResults) {
                        const copyButton = document.createElement('button');
                        copyButton.id = 'rekap2-copy-btn';
                        copyButton.textContent = "Salin Semua Hasil";
                        copyButton.className = 'terminal-button';
                        copyButton.onclick = function() {
                            navigator.clipboard.writeText(resultsEl.innerText).then(() => {
                                copyButton.textContent = "Berhasil Disalin!";
                                setTimeout(() => { copyButton.textContent = "Salin Semua Hasil"; }, 2000);
                            }).catch(err => {
                                const errorP = document.createElement('p');
                                errorP.className = 'error';
                                errorP.textContent = 'Gagal menyalin: ' + err;
                                resultsEl.appendChild(errorP);
                            });
                        };
                        kembaliBtn.parentElement.insertBefore(copyButton, kembaliBtn.previousElementSibling);
                    }
                });
                kembaliBtn.addEventListener('click', () => {
                    rekap2Container.style.display = 'none';
                    terminalContainer.style.display = 'block';
                    isTerminalActive = true;
                    terminalInput.focus();
                });
            }

            setupRekap1Tool();
            setupRekap2Tool();
            showPrompt();
            terminalInput.focus(); // Fokus ke input yang benar saat pertama kali dimuat
        });
    </script>
</body>
</html>
